
$ONUELLIST
OPTIONS ITERLIM = 500000000
*OPTIONS LIMROW = 1000  ** UNCOMMENT TO GET LISTING OF ALL CONSTRAINTS
OPTIONS WORK = 800000
OPTION MIP = CPLEX;

SETS
	J1	Sections	/S0*S4/
	M1	Time Steps	/0*67/

ALIAS ( J1, K1 )
ALIAS ( M1, R1 )

PARAMETERS

	L( J1 ) section length
	    /
		S4	0.243000
		S3	0.145000
		S2	0.230000
		S1	0.405000

	    /
	    	TABLE P(J1,M1) Evidence
          0     1     2     3     4     5     6     7     8     9    10    11    12    13    14    15    16    17    18    19    20    21    22    23    24    25    26    27    28    29    30    31    32    33    34    35    36    37    38    39    40    41    42    43    44    45    46    47    48    49    50    51    52    53    54    55    56    57    58    59    60    61    62    63    64    65    66    67
   S4   1.0   1.0   1.0   1.0   1.0   1.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   0.0   0.0   1.0   1.0   1.0
   S3   1.0   1.0   1.0   1.0   1.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0
   S2   1.0   1.0   1.0   1.0   1.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0
   S1   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   0.0   1.0   1.0   1.0
   S0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0
	TABLE V( J1, M1 )
          0     1     2     3     4     5     6     7     8     9    10    11    12    13    14    15    16    17    18    19    20    21    22    23    24    25    26    27    28    29    30    31    32    33    34    35    36    37    38    39    40    41    42    43    44    45    46    47    48    49    50    51    52    53    54    55    56    57    58    59    60    61    62    63    64    65    66    67
   S4  68.2  66.9  68.9  69.4  67.8  65.4  52.8  43.2  40.1  37.7  35.5  34.6  34.0  33.4  35.3  36.3  37.0  36.5  33.8  32.1  38.0  42.9  45.8  55.5  61.7  64.1  66.4  66.3  67.4  68.1  67.8  67.7  67.2  66.6  68.6  68.9  68.6  70.7  77.9  71.9  73.0  70.8  69.1  67.7  67.6  67.6  68.9  67.3  68.8  69.6  68.9  71.2  68.7  70.0  69.3  71.0  70.1  69.2  68.4  68.9  68.1  68.3  66.7  67.3  66.0  68.0  68.6  69.4
   S3  69.4  69.1  71.8  72.0  71.9  62.0  42.0  34.4  29.8  27.4  23.8  24.7  25.2  24.5  28.1  30.3  29.7  27.7  25.0  24.1  32.9  34.9  41.0  52.4  61.6  68.2  70.1  71.6  73.0  73.2  72.8  75.0  73.2  73.0  73.9  73.9  74.1  75.7  76.7  75.0  77.4  76.1  75.1  74.2  74.1  73.5  74.6  73.4  74.0  74.1  74.2  74.2  74.4  73.9  74.0  74.7  75.3  74.3  76.1  74.9  73.5  73.2  72.9  72.2  71.7  73.1  73.7  75.1
   S2  67.4  66.8  68.6  68.1  63.2  49.4  36.6  29.9  25.9  25.4  25.7  24.1  23.9  25.0  28.4  29.3  28.8  26.2  25.8  25.4  32.8  33.6  37.6  43.5  48.6  55.4  62.8  66.5  70.0  69.8  70.4  71.1  70.1  70.1  72.3  71.8  72.0  72.8  74.1  73.4  75.9  74.4  72.8  72.1  72.1  71.7  72.3  71.9  72.2  72.2  72.3  72.9  72.7  72.9  72.2  72.9  73.5  72.9  73.8  72.5  71.1  70.7  71.4  71.0  69.9  70.6  71.3  72.1
   S1  12.7  12.1  10.5   9.8   9.1   8.3   9.0   9.3   9.3   8.2   7.9   8.0   8.6   9.9   9.9  10.5   9.6  10.0   9.9  10.4  13.6  13.8  14.7  14.0  14.1  17.8  38.0  55.0  65.7  70.1  71.3  72.4  72.7  72.3  72.7  73.2  73.9  73.6  75.2  75.2  77.2  76.8  74.9  74.3  74.1  74.0  74.3  74.0  73.7  73.5  74.5  75.1  74.3  75.1  74.5  75.0  75.0  74.3  74.9  73.9  72.4  73.9  73.1  72.8  72.0  72.9  73.2  73.5
   S0  14.6  14.4  13.7  13.2  14.5  14.2  14.4  14.6  15.5  13.1  12.8  13.5  14.5  14.6  15.1  14.9  14.4  13.9  14.4  16.3  15.5  16.0  16.3  18.0  16.5  19.3  21.5  27.5  41.2  51.9  57.8  63.8  65.2  67.2  70.4  72.5  73.3  73.6  73.7  70.7  71.5  73.8  73.1  73.0  72.8  72.7  72.3  72.6  71.3  71.6  70.4  72.3  71.9  73.0  71.4  73.4  72.9  73.1  74.1  72.8  71.7  72.5  72.4  72.0  71.6  72.8  73.3  74.1
	TABLE AV( J1, M1 )
          0     1     2     3     4     5     6     7     8     9    10    11    12    13    14    15    16    17    18    19    20    21    22    23    24    25    26    27    28    29    30    31    32    33    34    35    36    37    38    39    40    41    42    43    44    45    46    47    48    49    50    51    52    53    54    55    56    57    58    59    60    61    62    63    64    65    66    67
   S4  67.6  67.9  68.1  68.2  68.4  68.0  67.6  67.2  67.2  67.2  67.1  66.8  66.7  66.7  66.8  67.3  66.9  66.6  66.3  66.1  66.3  66.5  66.8  67.0  67.1  67.3  67.8  68.2  68.5  68.6  68.8  69.3  69.2  69.2  68.8  68.9  68.9  68.8  69.2  69.1  69.5  69.5  69.3  69.6  69.7  69.7  69.6  69.6  69.5  69.7  69.6  69.7  70.1  70.1  70.0  70.1  70.2  69.8  69.9  69.8  70.1  70.1  69.7  70.2  70.1  69.9  70.0  69.9
   S3  68.2  68.6  68.7  68.8  69.3  68.6  68.0  67.7  67.6  67.9  68.3  68.1  68.3  68.1  67.9  68.0  68.2  67.9  67.3  67.1  67.1  67.4  67.5  67.7  67.7  68.2  69.0  69.7  70.4  70.9  71.2  71.5  71.6  71.8  71.7  71.8  71.9  71.9  72.0  71.9  72.5  72.1  72.0  72.1  72.1  72.3  72.1  72.3  72.3  72.5  72.5  72.5  73.0  72.6  72.7  72.7  72.3  72.2  72.2  72.2  72.3  72.3  72.4  72.5  72.6  72.4  72.3  72.1
   S2  66.4  66.6  66.5  66.9  67.5  66.8  66.1  65.8  65.7  66.0  66.6  66.8  67.0  67.1  66.9  67.0  67.1  66.8  66.3  66.2  66.2  66.1  66.2  66.3  66.3  66.5  67.2  68.0  68.6  69.1  69.8  70.2  70.3  70.6  70.6  70.6  70.8  70.7  70.7  70.9  71.0  70.8  70.8  70.9  70.9  71.1  70.9  70.8  70.9  71.0  71.1  71.0  71.3  71.0  71.1  71.1  70.9  70.7  70.5  70.4  70.4  70.4  70.5  70.6  70.7  70.4  70.4  70.3
   S1  53.8  54.4  54.5  54.7  55.3  55.2  53.8  51.9  51.0  51.7  53.3  55.1  56.4  56.1  55.8  56.0  56.5  57.3  57.6  57.7  57.2  56.8  56.9  57.1  58.6  59.4  60.2  61.9  64.0  65.9  67.7  69.1  69.9  71.0  71.9  72.2  72.6  72.8  72.8  72.9  73.7  73.3  73.3  73.2  73.2  73.3  73.2  73.1  73.3  73.3  73.4  73.3  73.6  73.3  73.2  73.1  72.9  72.9  72.8  72.6  72.7  72.7  72.8  72.9  73.2  72.9  73.0  72.7
   S0  41.6  42.3  41.4  41.9  43.0  42.3  40.6  39.0  38.1  38.3  39.1  39.7  40.3  40.9  41.5  42.3  43.9  45.5  46.6  47.8  48.4  49.4  50.6  52.0  52.6  52.2  52.6  53.5  55.2  56.7  58.5  60.7  63.1  65.1  66.8  67.6  68.0  68.0  68.0  68.5  69.3  69.5  69.6  70.3  70.5  70.7  70.8  71.2  71.2  71.1  71.2  71.1  71.6  71.2  71.0  70.7  70.2  70.6  70.5  70.0  70.2  70.5  70.8  71.0  71.3  71.4  71.4  70.6
	TABLE F( J1, M1 )
          0     1     2     3     4     5     6     7     8     9    10    11    12    13    14    15    16    17    18    19    20    21    22    23    24    25    26    27    28    29    30    31    32    33    34    35    36    37    38    39    40    41    42    43    44    45    46    47    48    49    50    51    52    53    54    55    56    57    58    59    60    61    62    63    64    65    66    67
   S4   445   420   457   450   468   497   493   472   456   423   377   426   441   422   480   457   484   464   455   451   555   536   531   558   521   498   467   495   469   452   468   456   401   442   418   370   326   422   369   369   367   319   351   347   346   342   350   279   313   287   277   277   260   238   295   274   290   286   282   270   305   284   275   267   267   235   245   236
   S3   468   440   483   468   535   506   478   474   446   417   370   426   440   439   488   463   480   460   443   463   573   535   561   575   545   519   489   516   481   467   496   474   411   461   431   370   337   437   371   387   368   333   356   355   361   350   358   288   329   296   287   284   266   245   296   278   301   295   286   281   304   290   275   275   284   242   246   250
   S2   506   458   480   476   557   541   517   488   497   448   398   447   468   482   503   495   518   492   472   523   601   543   586   575   576   527   480   545   487   480   497   466   423   445   417   403   354   448   386   375   381   336   369   372   365   347   366   300   324   304   298   290   277   263   315   292   306   290   287   315   320   289   264   288   279   259   268   255
   S1   468   372   376   368   318   322   386   354   386   297   357   338   364   394   405   402   342   404   399   429   526   478   409   524   495   568   536   539   524   506   504   503   431   474   432   407   385   442   429   387   433   367   393   378   381   375   395   316   351   319   323   311   285   284   345   322   368   299   306   300   356   311   290   288   299   266   280   285
   S0   427   376   378   342   356   368   376   424   385   303   351   415   362   449   399   393   398   382   423   525   473   518   505   563   509   608   604   598   586   521   534   531   451   513   485   420   428   452   463   443   392   405   413   414   399   396   416   349   371   337   352   342   313   319   351   344   396   326   337   340   363   331   309   330   295   304   295   309
	TABLE AF( J1, M1 )
          0     1     2     3     4     5     6     7     8     9    10    11    12    13    14    15    16    17    18    19    20    21    22    23    24    25    26    27    28    29    30    31    32    33    34    35    36    37    38    39    40    41    42    43    44    45    46    47    48    49    50    51    52    53    54    55    56    57    58    59    60    61    62    63    64    65    66    67
   S4   423   428   434   431   433   437   427   428   424   420   423   427   428   432   443   439   444   442   445   446   455   454   457   455   446   440   429   423   408   402   405   402   396   384   371   369   357   349   338   327   321   312   318   309   311   299   290   282   282   287   277   272   269   269   277   283   283   277   266   264   257   246   245   230   227   223   224   222
   S3   442   441   448   441   449   447   436   436   433   426   425   430   438   437   450   443   458   455   455   461   470   468   473   469   465   459   451   445   433   424   426   428   419   409   396   390   378   370   360   348   343   335   339   329   329   316   301   293   294   302   293   282   279   284   293   300   300   296   284   282   276   263   257   247   238   234   236   237
   S2   466   464   467   464   471   471   469   459   461   446   447   450   457   457   465   463   471   474   476   480   487   483   485   487   479   472   466   453   445   435   439   435   430   415   404   401   391   381   369   355   350   347   349   344   341   329   314   305   308   312   301   292   290   295   307   311   314   304   294   293   288   277   270   263   254   255   263   257
   S1   428   429   429   428   429   431   428   422   420   410   417   424   429   428   430   431   443   451   455   460   463   459   465   467   465   462   461   455   448   441   448   442   438   421   417   415   406   394   384   368   367   360   365   360   351   340   327   316   315   323   314   304   304   308   324   330   331   319   310   307   304   290   283   275   263   262   269   264
   S0   476   472   476   472   481   488   480   471   469   468   461   468   467   459   467   464   478   489   492   494   492   495   507   510   497   502   499   493   489   491   494   490   482   468   460   457   449   432   426   408   408   395   406   396   391   381   367   359   356   359   354   342   340   346   365   371   370   355   347   343   345   331   323   311   301   305   307   304

VARIABLES
	Z		objective
	D(J1,M1)	incident state
	Y		total incident delay
	A		average delay
	N		net delay

BINARY VARIABLE D

EQUATIONS
OBJECTIVE
EQ1
EQ2
 EQ3
 EQ4
 EQ5
 EQ6
 EQ7
TOTDELAY
AVGDELAY
NETDELAY
;

 OBJECTIVE ..	Z=E=SUM( J1, SUM( M1, P( J1, M1 ) * D( J1, M1 ) + ( 1 - P( J1, M1 ) ) * ( 1 - D( J1, M1 ) ) ) ); 
* OBJECTIVE ..	Z=E=SUM( J1, SUM( M1, -0.1 * D( J1, M1 ) + P(J1,M1) * D( J1, M1 ) + ( 1 - P( J1, M1 ) ) * ( 1 - D( J1, M1 ) ) ) ); 
* OBJECTIVE ..	Z=E=SUM( J1, SUM( M1, 0.1*P(J1,M1) * D( J1, M1 ) + ( 1 - P( J1, M1 ) ) * ( 1 - D( J1, M1 ) ) ) ); 
EQ1(J1,M1) ..	SUM( K1$(ORD( K1 ) < ORD( J1 ) ), D( K1, M1 ) ) =l= CARD(J1) -  CARD(J1) * ( D( J1, M1 ) - D( J1-1, M1 ) );
EQ2(J1,M1) ..	SUM( R1$(ORD( R1 ) > ORD( M1 ) ), D( J1, R1 ) ) =l= CARD(M1) -  CARD(M1) * ( D( J1, M1 ) - D( J1, M1+1 ) );
 EQ3(J1,M1) ..	SUM( R1$(ORD( R1 ) > ORD( M1 ) ), D( J1, R1 ) ) =l= CARD(M1) +  CARD(M1) * ( D( J1, M1 ) - D( J1-1, M1 ) );
***             the sum over all cells upstream and later than the target cell must be zero if the target cell is a boundary cell in space(-) and time(+)
 EQ4(J1,M1) ..	SUM( K1$(ORD( K1 ) < ORD( J1 ) ), SUM( R1$(ORD( R1 ) > ORD( M1 ) ), D( K1, R1 ) ) ) 
                  =l= 2*CARD(M1) * CARD(J1) -  CARD(M1) * CARD(J1) * ( D( J1, M1 ) - D( J1-1, M1 ) + D( J1, M1 ) - D( J1, M1+1 ) );
***             the sum over all cells downstream and later than the target cell must be zero if the target cell is a boundary cell in space(+) and time(+)
 EQ5(J1,M1) ..	SUM( K1$(ORD( K1 ) > ORD( J1 ) ), SUM( R1$(ORD( R1 ) > ORD( M1 ) ), D( K1, R1 ) ) ) 
                  =l= 2*CARD(M1) * CARD(J1) -  CARD(M1) * CARD(J1) * ( D( J1, M1 ) - D( J1+1, M1 ) + D( J1, M1 ) - D( J1, M1+1 ) );
***             the sum over all cells downstream and earlier than the target cell must be zero if the target cell is a boundary cell in space(+) and time(-)
 EQ6(J1,M1) ..	SUM( K1$(ORD( K1 ) > ORD( J1 ) ), SUM( R1$(ORD( R1 ) < ORD( M1 ) ), D( K1, R1 ) ) ) 
                  =l= 2*CARD(M1) * CARD(J1) -  CARD(M1) * CARD(J1) * ( D( J1, M1 ) - D( J1+1, M1 ) + D( J1, M1 ) - D( J1, M1-1 ) );
***             the sum over all cells upstream and earlier than the target cell must be zero if the target cell is a boundary cell in space(-) and time(-)
 EQ7(J1,M1) ..	SUM( K1$(ORD( K1 ) < ORD( J1 ) ), SUM( R1$(ORD( R1 ) < ORD( M1 ) ), D( K1, R1 ) ) ) 
                  =l= 2*CARD(M1) * CARD(J1) -  CARD(M1) * CARD(J1) * ( D( J1, M1 ) - D( J1-1, M1 ) + D( J1, M1 ) - D( J1, M1-1 ) );
TOTDELAY ..	Y=E=SUM( J1, SUM( M1, L( J1 ) / V(J1,M1) * F( J1, M1 ) ) );
AVGDELAY ..	A=E=SUM( J1, SUM( M1, L( J1 ) / AV(J1,M1) * AF( J1, M1 ) ) );
NETDELAY ..	N=E=Y-A

MODEL BASE / ALL /;
SOLVE BASE USING MIP MINIMIZING Z;
DISPLAY D.l;
