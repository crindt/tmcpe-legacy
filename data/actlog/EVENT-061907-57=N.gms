
$ONUELLIST
OPTIONS ITERLIM = 500000000
*OPTIONS LIMROW = 1000  ** UNCOMMENT TO GET LISTING OF ALL CONSTRAINTS
OPTIONS WORK = 800000
OPTION MIP = CPLEX;

SETS
	J1	Sections	/S0*S4/
	M1	Time Steps	/0*83/

ALIAS ( J1, K1 )
ALIAS ( M1, R1 )

PARAMETERS

	L( J1 ) section length
	    /
		S4	0.243000
		S3	0.145000
		S2	0.230000
		S1	0.405000

	    /
	    	TABLE P(J1,M1) Evidence
          0     1     2     3     4     5     6     7     8     9    10    11    12    13    14    15    16    17    18    19    20    21    22    23    24    25    26    27    28    29    30    31    32    33    34    35    36    37    38    39    40    41    42    43    44    45    46    47    48    49    50    51    52    53    54    55    56    57    58    59    60    61    62    63    64    65    66    67    68    69    70    71    72    73    74    75    76    77    78    79    80    81    82    83
   S4   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0
   S3   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   0.0   0.0   1.0   1.0   1.0   1.0   1.0   1.0   0.0   0.0   1.0   1.0   1.0   1.0   0.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   0.0   1.0   1.0   1.0   1.0   0.0
   S2   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   0.0   0.0   0.0   1.0   1.0   1.0   1.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   0.0   1.0   1.0   1.0   1.0   1.0   1.0   0.0   0.0   0.0   0.0   1.0   0.0   0.0   0.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   0.0   1.0   1.0   1.0   1.0   1.0
   S1   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   1.0   1.0   0.0   1.0   1.0   1.0   1.0   0.0   0.0   0.0   0.0   0.0   1.0   0.0   1.0   0.0   0.0   0.0   0.0   0.0   0.0   1.0   0.0   0.0   0.0   1.0   0.0   0.0   1.0   1.0   1.0   1.0   1.0   0.0   1.0   1.0   1.0   1.0   1.0
   S0   1.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   0.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0
	TABLE V( J1, M1 )
          0     1     2     3     4     5     6     7     8     9    10    11    12    13    14    15    16    17    18    19    20    21    22    23    24    25    26    27    28    29    30    31    32    33    34    35    36    37    38    39    40    41    42    43    44    45    46    47    48    49    50    51    52    53    54    55    56    57    58    59    60    61    62    63    64    65    66    67    68    69    70    71    72    73    74    75    76    77    78    79    80    81    82    83
   S4  68.2  68.9  68.7  68.8  68.3  68.9  68.1  70.3  69.6  69.8  70.3  70.1  70.3  69.7  70.7  70.1  69.6  70.3  70.3  70.7  72.0  69.9  69.7  67.7  67.7  66.8  56.0  55.3  53.5  57.0  51.3  41.5  39.7  39.3  40.0  36.7  43.0  55.1  62.3  67.9  68.5  69.9  69.8  69.4  69.1  69.2  70.1  72.3  72.4  72.1  71.6  70.3  69.9  69.6  70.2  70.8  71.6  73.7  71.8  71.9  72.5  72.3  71.2  70.9  71.5  72.6  73.1  72.6  72.1  72.3  72.9  72.1  72.1  72.5  72.9  72.9  72.2  71.1  72.5  72.4  72.6  72.8  73.0  72.3
   S3  68.0  68.9  69.0  68.2  68.9  68.2  68.0  68.9  69.3  68.2  69.8  69.1  69.5  69.5  69.7  69.4  68.5  68.0  69.2  70.6  72.0  70.0  69.9  66.6  65.6  60.7  44.4  40.8  37.0  42.9  33.6  23.7  19.8  19.6  19.4  17.7  25.1  41.5  56.0  65.3  67.0  67.0  66.4  67.8  68.4  68.1  68.7  68.4  70.9  71.1  70.5  69.9  70.1  70.1  69.9  68.6  70.8  72.6  71.4  76.3  73.5  72.8  70.1  69.3  70.3  70.5  71.6  71.7  70.3  71.0  71.3  70.8  70.7  71.8  71.8  71.5  70.7  69.8  69.4  70.3  71.0  71.3  71.3  69.7
   S2  67.1  66.9  67.2  66.8  66.3  66.1  66.1  67.5  67.7  67.2  68.0  68.1  67.9  67.9  66.6  66.3  66.5  66.8  67.6  69.7  69.8  66.3  61.3  56.6  54.0  47.5  38.4  37.8  34.9  32.6  25.4  22.1  19.7  19.6  19.6  19.0  22.3  32.4  49.2  59.4  63.3  60.9  58.2  63.7  66.0  66.8  67.9  70.7  70.9  70.1  70.1  69.0  68.7  68.9  68.9  67.8  69.0  70.9  70.1  69.9  69.7  70.3  68.5  67.6  67.4  68.0  69.1  67.2  67.0  68.3  69.3  69.4  68.9  69.6  69.0  69.6  69.2  68.3  67.7  68.5  69.7  70.3  69.4  68.5
   S1  66.5  66.9  66.4  65.6  65.5  66.0  63.4  59.9  45.4  30.4  37.9  48.7  50.7  31.5  21.3  16.0  13.4  12.3  12.1  11.2  10.1   8.8   8.4   9.0   9.1   8.4   9.3   9.0   9.5   8.9   9.1   9.6   9.4  10.2  10.0  11.6  12.3  19.7  34.4  49.4  55.3  57.3  56.7  60.8  64.5  66.4  67.2  67.1  69.4  70.2  70.6  70.5  69.8  70.2  70.0  70.0  69.4  70.9  69.8  70.9  70.5  70.9  70.7  70.3  68.7  70.2  71.1  69.6  69.7  70.0  72.0  70.9  71.0  72.0  72.6  72.3  71.4  70.9  69.7  71.0  71.4  71.5  72.0  71.4
   S0  39.2  34.8  29.4  22.9  20.9  21.2  19.6  17.8  15.8  17.0  18.7  18.1  16.3  15.6  14.5  15.1  14.4  14.7  14.2  12.9  12.4  12.0  11.3  11.2  11.3  12.2  12.6  13.1  13.2  13.0  11.7  12.5  13.0  13.9  12.9  13.3  15.4  18.6  18.8  34.5  51.6  61.5  62.7  65.0  67.1  68.8  68.4  68.3  68.5  69.2  70.6  69.0  68.2  68.2  69.5  68.5  69.4  69.8  70.4  73.6  70.9  70.9  69.3  68.3  68.3  69.4  70.2  68.5  67.7  68.4  69.8  70.1  70.1  70.7  70.4  71.5  70.5  70.1  70.9  71.0  71.1  73.0  72.1  71.7
	TABLE AV( J1, M1 )
          0     1     2     3     4     5     6     7     8     9    10    11    12    13    14    15    16    17    18    19    20    21    22    23    24    25    26    27    28    29    30    31    32    33    34    35    36    37    38    39    40    41    42    43    44    45    46    47    48    49    50    51    52    53    54    55    56    57    58    59    60    61    62    63    64    65    66    67    68    69    70    71    72    73    74    75    76    77    78    79    80    81    82    83
   S4  67.2  67.2  67.2  67.4  67.4  67.5  67.7  67.8  68.3  68.3  68.5  68.9  68.6  68.7  68.9  68.8  68.5  68.4  68.4  68.2  68.2  68.2  67.9  68.0  67.8  67.6  67.4  67.1  67.1  67.1  67.1  67.0  67.2  67.3  67.0  67.8  68.1  68.5  68.8  68.9  69.1  69.1  68.8  68.9  69.0  68.9  68.8  69.4  69.3  69.3  69.4  69.7  69.7  69.9  70.0  69.7  69.9  69.8  70.0  70.2  70.0  70.1  70.4  70.2  69.9  69.9  69.8  70.1  70.3  70.6  70.2  70.4  70.3  70.1  70.0  70.1  70.0  69.9  70.2  70.3  70.1  69.9  70.0  69.9
   S3  67.4  67.5  67.6  67.8  68.2  68.4  68.4  68.3  68.7  68.7  68.9  69.8  69.4  69.5  69.4  69.5  69.4  69.4  69.3  69.1  68.9  68.9  68.5  68.5  68.2  68.0  67.6  67.1  67.2  67.3  67.1  67.2  67.4  67.6  67.2  68.1  68.6  69.2  69.7  70.0  70.1  70.1  69.8  69.8  69.9  69.8  69.7  70.9  70.8  70.8  70.8  71.0  71.2  71.4  71.4  71.6  71.6  71.7  71.8  72.2  72.0  72.0  71.9  71.8  71.5  71.6  71.5  71.6  72.0  72.1  71.9  71.7  71.7  71.6  71.3  71.3  71.4  71.5  71.6  71.5  71.2  71.6  71.6  71.7
   S2  66.2  66.2  66.2  66.7  66.8  67.0  67.0  67.0  67.3  67.4  67.5  68.3  68.1  68.1  68.1  68.3  68.4  68.5  68.3  68.1  68.2  68.2  67.7  67.6  67.3  67.0  66.7  66.2  66.2  66.1  65.8  65.4  65.4  65.7  65.6  66.4  67.0  67.9  68.6  69.1  69.3  69.3  69.0  68.9  68.9  69.1  69.0  69.7  69.5  69.3  69.4  69.4  69.5  69.7  69.6  69.7  69.9  69.9  69.9  70.2  70.1  70.1  70.0  70.0  69.8  69.7  69.6  69.8  69.9  70.2  70.1  69.9  69.9  69.9  70.0  69.9  69.8  69.9  69.8  69.8  69.8  70.1  69.8  69.5
   S1  62.4  62.3  61.6  61.7  61.6  62.0  62.4  61.6  61.1  61.7  63.3  65.2  65.5  64.5  63.0  62.3  62.1  62.7  63.8  64.0  64.3  64.3  64.1  64.2  64.5  64.5  64.4  63.9  64.3  64.9  64.7  64.0  63.1  63.3  62.8  63.7  64.4  65.8  67.0  68.2  69.0  69.4  69.4  69.9  70.3  70.6  70.4  71.4  71.3  71.4  71.7  71.8  71.9  72.0  72.1  72.3  72.2  72.3  72.4  72.6  72.3  72.5  72.5  72.4  72.3  72.2  72.1  72.1  72.6  72.8  72.8  72.8  72.9  72.9  72.9  72.4  72.5  72.5  72.7  72.6  72.2  72.2  72.5  72.3
   S0  52.0  51.7  51.3  51.9  51.9  52.1  50.9  49.8  49.7  49.5  50.4  52.3  51.1  49.2  46.7  45.4  46.8  48.2  48.7  49.2  48.6  47.8  49.4  51.3  51.8  53.4  54.7  55.4  55.6  56.8  56.6  56.5  57.2  57.9  58.4  59.6  59.7  60.0  60.7  62.5  64.1  65.4  65.8  66.1  66.3  66.7  67.4  68.4  68.3  68.3  68.3  69.0  69.4  69.6  69.7  70.0  70.2  70.4  70.4  70.8  70.5  70.5  70.4  70.1  69.9  70.0  70.2  70.1  70.5  70.7  70.6  70.7  70.8  70.5  70.2  69.6  69.8  70.1  69.8  69.8  70.0  70.0  70.1  70.4
	TABLE F( J1, M1 )
          0     1     2     3     4     5     6     7     8     9    10    11    12    13    14    15    16    17    18    19    20    21    22    23    24    25    26    27    28    29    30    31    32    33    34    35    36    37    38    39    40    41    42    43    44    45    46    47    48    49    50    51    52    53    54    55    56    57    58    59    60    61    62    63    64    65    66    67    68    69    70    71    72    73    74    75    76    77    78    79    80    81    82    83
   S4   432   462   484   438   488   431   481   496   438   488   468   461   447   492   482   486   427   480   470   456   466   472   472   509   492   523   492   485   527   539   491   462   454   481   458   430   446   448   415   440   374   429   420   375   327   367   351   361   340   326   335   339   321   293   315   311   299   303   314   295   314   290   305   261   271   301   270   278   274   299   265   234   241   238   193   264   248   190   198   187   160   175   158   255
   S3   434   483   477   459   486   447   484   520   466   503   490   477   472   503   489   511   422   453   474   457   469   487   487   517   519   522   499   515   519   549   460   467   455   481   469   457   473   478   466   466   407   442   447   403   377   414   376   356   363   361   365   389   360   314   341   334   307   316   321   326   342   294   319   283   278   305   294   278   267   317   279   253   255   246   208   285   263   200   200   192   173   171   176   229
   S2   474   503   521   465   509   471   486   548   496   538   490   498   519   514   511   506   470   475   496   457   487   505   515   535   532   532   532   553   571   543   458   480   477   504   457   494   521   518   475   483   417   455   444   404   384   413   385   405   374   361   387   395   384   328   360   346   326   330   332   304   342   319   338   306   285   334   322   315   311   329   306   284   264   295   222   313   284   238   249   250   216   190   202   248
   S1   439   489   491   472   486   456   473   491   460   490   460   470   487   407   441   425   397   392   406   391   365   322   343   381   366   339   418   380   396   347   371   419   382   436   393   454   469   516   470   454   405   433   433   450   386   418   390   375   396   373   368   421   418   333   368   348   354   343   362   314   338   352   358   318   299   346   320   328   307   346   306   277   276   300   254   315   284   240   230   255   211   192   212   250
   S0   526   523   514   479   537   491   443   504   397   551   539   478   431   442   446   474   405   448   390   387   338   343   359   387   339   372   425   354   397   332   385   399   395   443   406   455   497   595   536   508   423   451   486   484   401   448   410   423   422   402   384   463   419   382   384   407   376   375   381   406   387   399   368   374   343   396   387   419   380   442   353   308   361   382   335   348   358   326   329   328   263   226   218   275
	TABLE AF( J1, M1 )
          0     1     2     3     4     5     6     7     8     9    10    11    12    13    14    15    16    17    18    19    20    21    22    23    24    25    26    27    28    29    30    31    32    33    34    35    36    37    38    39    40    41    42    43    44    45    46    47    48    49    50    51    52    53    54    55    56    57    58    59    60    61    62    63    64    65    66    67    68    69    70    71    72    73    74    75    76    77    78    79    80    81    82    83
   S4   435   433   440   441   433   433   444   433   426   430   430   437   432   432   432   429   429   434   431   439   433   439   440   453   442   452   443   453   452   451   451   439   431   422   422   410   404   397   399   394   378   374   361   350   337   328   311   312   306   301   304   305   289   275   272   274   269   261   254   246   257   263   263   266   260   252   242   248   235   228   219   208   202   212   207   205   189   176   167   159   157   149   132   123
   S3   458   456   461   459   453   452   461   453   446   448   447   453   449   450   448   442   442   446   446   452   450   455   454   472   461   469   465   474   475   474   472   469   458   450   450   443   434   430   431   426   411   405   392   377   363   354   336   339   326   326   332   330   312   292   291   289   285   280   269   264   274   284   288   290   285   275   263   268   254   245   235   225   218   231   226   223   205   188   179   168   164   158   139   131
   S2   486   487   487   475   475   473   485   480   473   472   467   476   478   482   477   469   466   467   465   474   470   469   476   493   478   489   485   494   492   489   487   481   466   464   457   447   444   437   437   435   418   411   401   389   374   361   346   347   339   336   340   340   324   301   304   301   297   292   280   277   287   297   303   305   295   289   279   283   268   260   248   242   239   258   245   238   225   206   200   190   184   173   157   154
   S1   457   464   464   454   451   452   461   458   455   447   448   453   459   465   460   448   443   442   442   451   446   448   450   466   455   465   463   468   474   466   468   467   455   447   443   447   441   441   444   441   424   425   413   402   387   376   360   360   354   350   359   359   338   317   316   308   311   306   294   290   302   316   316   323   312   303   293   294   287   275   259   253   248   264   254   244   228   210   202   192   184   173   159   153
   S0   526   521   520   508   503   512   516   522   510   513   503   513   523   524   513   503   494   489   487   488   476   489   489   498   493   510   505   504   515   508   510   502   500   485   484   487   488   491   490   483   468   461   458   443   428   420   399   399   394   389   396   397   376   356   357   347   350   343   332   326   341   356   357   367   357   347   340   342   331   320   306   295   294   302   296   279   264   242   235   223   210   202   181   176

VARIABLES
	Z		objective
	D(J1,M1)	incident state
	Y		total incident delay
	A		average delay
	N		net delay

BINARY VARIABLE D

EQUATIONS
OBJECTIVE
EQ1
EQ2
 EQ3
 EQ4
 EQ5
 EQ6
 EQ7
TOTDELAY
AVGDELAY
NETDELAY
;

 OBJECTIVE ..	Z=E=SUM( J1, SUM( M1, P( J1, M1 ) * D( J1, M1 ) + ( 1 - P( J1, M1 ) ) * ( 1 - D( J1, M1 ) ) ) ); 
* OBJECTIVE ..	Z=E=SUM( J1, SUM( M1, -0.1 * D( J1, M1 ) + P(J1,M1) * D( J1, M1 ) + ( 1 - P( J1, M1 ) ) * ( 1 - D( J1, M1 ) ) ) ); 
* OBJECTIVE ..	Z=E=SUM( J1, SUM( M1, 0.1*P(J1,M1) * D( J1, M1 ) + ( 1 - P( J1, M1 ) ) * ( 1 - D( J1, M1 ) ) ) ); 
EQ1(J1,M1) ..	SUM( K1$(ORD( K1 ) < ORD( J1 ) ), D( K1, M1 ) ) =l= CARD(J1) -  CARD(J1) * ( D( J1, M1 ) - D( J1-1, M1 ) );
EQ2(J1,M1) ..	SUM( R1$(ORD( R1 ) > ORD( M1 ) ), D( J1, R1 ) ) =l= CARD(M1) -  CARD(M1) * ( D( J1, M1 ) - D( J1, M1+1 ) );
 EQ3(J1,M1) ..	SUM( R1$(ORD( R1 ) > ORD( M1 ) ), D( J1, R1 ) ) =l= CARD(M1) +  CARD(M1) * ( D( J1, M1 ) - D( J1-1, M1 ) );
***             the sum over all cells upstream and later than the target cell must be zero if the target cell is a boundary cell in space(-) and time(+)
 EQ4(J1,M1) ..	SUM( K1$(ORD( K1 ) < ORD( J1 ) ), SUM( R1$(ORD( R1 ) > ORD( M1 ) ), D( K1, R1 ) ) ) 
                  =l= 2*CARD(M1) * CARD(J1) -  CARD(M1) * CARD(J1) * ( D( J1, M1 ) - D( J1-1, M1 ) + D( J1, M1 ) - D( J1, M1+1 ) );
***             the sum over all cells downstream and later than the target cell must be zero if the target cell is a boundary cell in space(+) and time(+)
 EQ5(J1,M1) ..	SUM( K1$(ORD( K1 ) > ORD( J1 ) ), SUM( R1$(ORD( R1 ) > ORD( M1 ) ), D( K1, R1 ) ) ) 
                  =l= 2*CARD(M1) * CARD(J1) -  CARD(M1) * CARD(J1) * ( D( J1, M1 ) - D( J1+1, M1 ) + D( J1, M1 ) - D( J1, M1+1 ) );
***             the sum over all cells downstream and earlier than the target cell must be zero if the target cell is a boundary cell in space(+) and time(-)
 EQ6(J1,M1) ..	SUM( K1$(ORD( K1 ) > ORD( J1 ) ), SUM( R1$(ORD( R1 ) < ORD( M1 ) ), D( K1, R1 ) ) ) 
                  =l= 2*CARD(M1) * CARD(J1) -  CARD(M1) * CARD(J1) * ( D( J1, M1 ) - D( J1+1, M1 ) + D( J1, M1 ) - D( J1, M1-1 ) );
***             the sum over all cells upstream and earlier than the target cell must be zero if the target cell is a boundary cell in space(-) and time(-)
 EQ7(J1,M1) ..	SUM( K1$(ORD( K1 ) < ORD( J1 ) ), SUM( R1$(ORD( R1 ) < ORD( M1 ) ), D( K1, R1 ) ) ) 
                  =l= 2*CARD(M1) * CARD(J1) -  CARD(M1) * CARD(J1) * ( D( J1, M1 ) - D( J1-1, M1 ) + D( J1, M1 ) - D( J1, M1-1 ) );
TOTDELAY ..	Y=E=SUM( J1, SUM( M1, L( J1 ) / V(J1,M1) * F( J1, M1 ) ) );
AVGDELAY ..	A=E=SUM( J1, SUM( M1, L( J1 ) / AV(J1,M1) * AF( J1, M1 ) ) );
NETDELAY ..	N=E=Y-A

MODEL BASE / ALL /;
SOLVE BASE USING MIP MINIMIZING Z;
DISPLAY D.l;
