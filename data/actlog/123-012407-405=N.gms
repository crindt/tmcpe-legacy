
$ONUELLIST
OPTIONS ITERLIM = 500000000
*OPTIONS LIMROW = 1000  ** UNCOMMENT TO GET LISTING OF ALL CONSTRAINTS
OPTIONS WORK = 800000
OPTION MIP = CPLEX;

SETS
	J1	Sections	/S0*S4/
	M1	Time Steps	/0*41/

ALIAS ( J1, K1 )
ALIAS ( M1, R1 )

PARAMETERS

	L( J1 ) section length
	    /
		S4	0.350000
		S3	0.255000
		S2	0.320000
		S1	0.410000

	    /
	    	TABLE P(J1,M1) Evidence
          0     1     2     3     4     5     6     7     8     9    10    11    12    13    14    15    16    17    18    19    20    21    22    23    24    25    26    27    28    29    30    31    32    33    34    35    36    37    38    39    40    41
   S4   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5
   S3   1.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   0.0   1.0   1.0   1.0   0.0   0.0   0.0   0.0   0.0   0.0   1.0   1.0   0.0   0.0   0.0   0.0
   S2   1.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0
   S1   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5
   S0   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   0.5   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   1.0   0.0   1.0   0.0   0.0   1.0   1.0   1.0   0.0   0.0   0.0   0.0
	TABLE V( J1, M1 )
          0     1     2     3     4     5     6     7     8     9    10    11    12    13    14    15    16    17    18    19    20    21    22    23    24    25    26    27    28    29    30    31    32    33    34    35    36    37    38    39    40    41
   S4   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
   S3  68.1  48.0  35.6  27.0  20.8  19.0  20.9  19.9  21.8  25.2  24.8  38.5  53.1  59.8  64.2  66.2  65.8  66.6  62.4  63.3  64.1  65.1  64.2  64.9  64.3  65.3  64.4  65.6  66.1  64.7  64.3  63.8  63.7  63.8  62.4  62.3  64.3  64.5  63.2  61.3  61.5  62.2
   S2  65.9  40.4  27.4  19.7  14.3  10.6   9.0   9.8  13.1  12.8  14.3  37.6  54.0  59.8  65.0  68.3  69.1  68.1  67.8  66.9  67.9  67.4  67.4  68.1  68.1  68.9  68.4  69.9  70.0  69.6  70.4  67.9  68.7  69.0  69.2  68.9  70.2  69.9  68.4  66.3  66.2  67.7
   S1  63.4  49.0  41.1  36.5  33.3  31.4  30.4  29.7  30.3  30.6  33.5  47.5  55.5  59.1  60.6  61.4  49.4  49.6  47.8  48.8  49.1  54.3  56.6  57.8  57.6  57.4  57.1  57.3  57.1  58.2  57.5  56.9  57.3  57.5  56.6  57.7  58.9  58.6  57.0  55.4  55.0  55.8
   S0  54.6  42.1  30.0  23.2  20.2  19.0  17.3  18.3  14.9  15.3  16.1  18.6  27.3  24.2  18.8  16.4  21.1  20.4  15.4  19.6  22.8  44.9  54.1  58.0  59.5  60.6  60.1  60.5  59.4  61.6  60.2  59.0  60.3  58.4  58.4  59.2  60.7  61.0  59.1  57.5  58.1  57.4
	TABLE AV( J1, M1 )
          0     1     2     3     4     5     6     7     8     9    10    11    12    13    14    15    16    17    18    19    20    21    22    23    24    25    26    27    28    29    30    31    32    33    34    35    36    37    38    39    40    41
   S4   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0   0.0
   S3  65.9  62.3  58.3  54.7  51.2  49.5  49.6  50.2  51.5  52.4  53.1  53.2  53.3  53.5  53.9  54.2  54.7  54.7  56.2  58.0  60.1  61.9  63.8  65.5  65.8  66.8  67.2  67.3  67.1  67.1  67.1  67.1  67.4  66.6  66.1  65.9  65.7  65.6  65.6  65.5  65.3  65.4
   S2  61.0  56.0  50.9  46.1  41.4  39.0  38.2  38.2  39.8  40.9  42.0  43.1  43.7  44.0  44.2  45.0  45.6  45.9  47.3  49.7  52.5  54.8  58.4  60.6  62.1  63.8  64.7  65.4  65.3  65.3  65.4  65.5  66.1  65.4  65.0  64.9  64.7  64.6  64.7  64.8  64.5  64.6
   S1  52.6  47.1  41.5  37.4  33.3  31.2  28.9  29.5  30.6  30.8  30.3  30.5  31.0  31.4  31.9  33.5  34.7  34.8  34.9  36.6  39.5  42.9  45.8  47.4  48.9  49.9  50.4  50.7  50.3  50.1  49.9  50.3  50.0  49.9  50.1  49.1  49.3  49.5  49.1  49.1  49.4  50.2
   S0  43.6  35.7  30.6  25.9  22.6  20.5  20.3  20.2  21.1  21.1  23.0  24.2  23.6  23.1  24.7  24.9  26.0  27.4  30.1  32.1  37.0  42.1  46.1  50.1  53.1  55.6  58.1  58.8  59.3  60.1  61.0  61.3  62.0  61.7  60.9  61.0  61.1  60.9  61.0  61.1  60.5  60.9
	TABLE F( J1, M1 )
          0     1     2     3     4     5     6     7     8     9    10    11    12    13    14    15    16    17    18    19    20    21    22    23    24    25    26    27    28    29    30    31    32    33    34    35    36    37    38    39    40    41
   S4     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0
   S3   576   523   312   334   312   291   299   339   388   352   441   448   378   375   408   416   400   399   436   397   416   394   395   418   433   449   448   411   444   432   450   448   418   389   381   361   368   433   364   392   402   407
   S2   506   321   185   178   180   197   209   254   274   241   384   410   318   326   365   387   340   351   402   369   374   366   355   378   393   421   413   401   410   419   418   439   393   372   376   336   365   396   362   366   389   376
   S1   505   349   232   215   230   239   242   272   336   333   431   433   373   377   386   414   471   456   398   459   461   500   463   479   493   519   452   487   538   468   513   529   508   466   499   451   471   499   461   484   490   508
   S0   665   587   552   533   520   493   512   516   439   497   497   480   441   433   445   418   522   431   362   464   440   470   434   484   459   496   425   488   516   439   498   502   495   447   459   440   434   473   455   439   491   458
	TABLE AF( J1, M1 )
          0     1     2     3     4     5     6     7     8     9    10    11    12    13    14    15    16    17    18    19    20    21    22    23    24    25    26    27    28    29    30    31    32    33    34    35    36    37    38    39    40    41
   S4     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0     0
   S3   594   563   546   533   499   450   431   404   425   414   422   422   421   401   418   414   437   422   419   393   413   400   428   425   448   437   452   448   452   450   432   408   400   393   398   403   401   391   388   396   398   401
   S2   514   478   451   431   384   355   337   327   340   336   342   344   347   334   344   353   362   362   356   346   364   362   390   393   413   406   424   422   425   424   408   389   379   374   380   386   381   372   371   378   377   380
   S1   593   577   563   532   503   470   451   444   442   439   438   451   427   425   443   441   459   457   447   455   459   478   484   483   487   499   495   503   504   499   486   451   452   440   453   467   471   453   449   463   460   465
   S0   551   537   512   476   452   422   426   411   417   394   399   417   380   402   433   408   436   431   431   447   461   454   467   480   482   505   487   499   503   494   484   464   450   435   448   454   455   445   441   449   455   457

VARIABLES
	Z		objective
	D(J1,M1)	incident state
	Y		total incident delay
	A		average delay
	N		net delay

BINARY VARIABLE D

EQUATIONS
OBJECTIVE
EQ1
EQ2
 EQ3
 EQ4
 EQ5
 EQ6
 EQ7
TOTDELAY
AVGDELAY
NETDELAY
;

 OBJECTIVE ..	Z=E=SUM( J1, SUM( M1, P( J1, M1 ) * D( J1, M1 ) + ( 1 - P( J1, M1 ) ) * ( 1 - D( J1, M1 ) ) ) ); 
* OBJECTIVE ..	Z=E=SUM( J1, SUM( M1, -0.1 * D( J1, M1 ) + P(J1,M1) * D( J1, M1 ) + ( 1 - P( J1, M1 ) ) * ( 1 - D( J1, M1 ) ) ) ); 
* OBJECTIVE ..	Z=E=SUM( J1, SUM( M1, 0.1*P(J1,M1) * D( J1, M1 ) + ( 1 - P( J1, M1 ) ) * ( 1 - D( J1, M1 ) ) ) ); 
EQ1(J1,M1) ..	SUM( K1$(ORD( K1 ) < ORD( J1 ) ), D( K1, M1 ) ) =l= CARD(J1) -  CARD(J1) * ( D( J1, M1 ) - D( J1-1, M1 ) );
EQ2(J1,M1) ..	SUM( R1$(ORD( R1 ) > ORD( M1 ) ), D( J1, R1 ) ) =l= CARD(M1) -  CARD(M1) * ( D( J1, M1 ) - D( J1, M1+1 ) );
 EQ3(J1,M1) ..	SUM( R1$(ORD( R1 ) > ORD( M1 ) ), D( J1, R1 ) ) =l= CARD(M1) +  CARD(M1) * ( D( J1, M1 ) - D( J1-1, M1 ) );
***             the sum over all cells upstream and later than the target cell must be zero if the target cell is a boundary cell in space(-) and time(+)
 EQ4(J1,M1) ..	SUM( K1$(ORD( K1 ) < ORD( J1 ) ), SUM( R1$(ORD( R1 ) > ORD( M1 ) ), D( K1, R1 ) ) ) 
                  =l= 2*CARD(M1) * CARD(J1) -  CARD(M1) * CARD(J1) * ( D( J1, M1 ) - D( J1-1, M1 ) + D( J1, M1 ) - D( J1, M1+1 ) );
***             the sum over all cells downstream and later than the target cell must be zero if the target cell is a boundary cell in space(+) and time(+)
 EQ5(J1,M1) ..	SUM( K1$(ORD( K1 ) > ORD( J1 ) ), SUM( R1$(ORD( R1 ) > ORD( M1 ) ), D( K1, R1 ) ) ) 
                  =l= 2*CARD(M1) * CARD(J1) -  CARD(M1) * CARD(J1) * ( D( J1, M1 ) - D( J1+1, M1 ) + D( J1, M1 ) - D( J1, M1+1 ) );
***             the sum over all cells downstream and earlier than the target cell must be zero if the target cell is a boundary cell in space(+) and time(-)
 EQ6(J1,M1) ..	SUM( K1$(ORD( K1 ) > ORD( J1 ) ), SUM( R1$(ORD( R1 ) < ORD( M1 ) ), D( K1, R1 ) ) ) 
                  =l= 2*CARD(M1) * CARD(J1) -  CARD(M1) * CARD(J1) * ( D( J1, M1 ) - D( J1+1, M1 ) + D( J1, M1 ) - D( J1, M1-1 ) );
***             the sum over all cells upstream and earlier than the target cell must be zero if the target cell is a boundary cell in space(-) and time(-)
 EQ7(J1,M1) ..	SUM( K1$(ORD( K1 ) < ORD( J1 ) ), SUM( R1$(ORD( R1 ) < ORD( M1 ) ), D( K1, R1 ) ) ) 
                  =l= 2*CARD(M1) * CARD(J1) -  CARD(M1) * CARD(J1) * ( D( J1, M1 ) - D( J1-1, M1 ) + D( J1, M1 ) - D( J1, M1-1 ) );
TOTDELAY ..	Y=E=SUM( J1, SUM( M1, L( J1 ) / V(J1,M1) * F( J1, M1 ) ) );
AVGDELAY ..	A=E=SUM( J1, SUM( M1, L( J1 ) / AV(J1,M1) * AF( J1, M1 ) ) );
NETDELAY ..	N=E=Y-A

MODEL BASE / ALL /;
SOLVE BASE USING MIP MINIMIZING Z;
DISPLAY D.l;
